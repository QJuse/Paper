## LMDB

lmdb是轻量级Memory-Mapped数据库

原理：通过mmap将要访问的文件只读的映射到虚拟内存中，直接访问相应地址；

>IO的调度由操作系统的页调度机制完成。而写操作，则是通过write系统调用进行的，这主要是为了利用操作系统的文件系统一致性，避免在被访问的地址上进行同步?
>
>lmdb把整个虚拟存储组织成B+Tree存储

* 使用内存映射的优势

内存映射就是把物理内存映射到进程的地址空间之内，应用程序就可以直接使用输入输出的地址空间。使用内存映射文件处理存储于磁盘上的文件时，将不需要由应用程序对文件执行I/O操作：

> 这意味着在对文件进行处理时将不必再为文件申请并分配缓存，所有的文件缓存操作均由系统直接管理，由于取消了将文件数据加载到内存、数据从内存到文件的回写以及释放内存块等步骤，使得内存映射文件在处理大数据量的文件时能起到相当重要的作用

* 内存映射原理：pass

>通过内存映射的方法访问硬盘上的文件，效率要比read和write系统调用高， read()是系统调用，其中进行了数据拷贝，它首先将文件内容从硬盘拷贝到内核空间的一个缓冲区，然后再将这些数据拷贝到用户空间，在这个过程中，实际上完成了 **两次数据拷贝** ；而mmap()也是系统调用，如前所述，mmap()中没有进行数据拷贝，真正的数据拷贝是在缺页中断处理时进行的，由于mmap()将文件直接映射到用户空间，所以中断处理函数根据这个映射关系，直接将文件从硬盘拷贝到用户空间，只进行了 **一次数据拷贝** 。因此，内存映射的效率要比 read/write效率高。

* lmdb使用内存映射：pass
* B-tree/B+tree（平衡多路查找树）

[资料参考](http://wiki.dreamrunner.org/public_html/C-C++/Library-Notes/LMDB.html)

[官方文档](https://lmdb.readthedocs.io/en/release/)



### 实践问题：如何将大量图片写成lmdb格式

* 图片必须固定大小吗？
* 100多G的数据也能处理？单文件最大多少G

https://blog.csdn.net/P_LarT/article/details/103208405

### 实践问题：大数据集加速pytorch的dataloader

https://www.zhihu.com/question/356829360?sort=created